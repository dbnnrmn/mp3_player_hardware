// SPDX-License-Identifier: (GPL-2.0+ or MIT)
// Copyright (C) 2021 Samuel Holland <samuel@sholland.org>

/dts-v1/;

#include "sun20i-d1.dtsi"

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/pwm/pwm.h>

/ {
	model = "my player";
	compatible = "allwinner,d1-nezha", "allwinner,sun20i-d1";

	aliases {
		serial2 = &uart2;
		spi0 = &spi0;
	};

	chosen {
		stdout-path = "serial2:115200n8";
	};
	};

	reg_vcc: vcc {
		compatible = "regulator-fixed";
		regulator-name = "vcc";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
	};

	reg_vcc_3v3: vcc-3v3 {
		compatible = "regulator-fixed";
		regulator-name = "vcc-3v3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&reg_vcc>;
	};

};

&gpio {
	vcc-pa-supply = <&reg_vcc_3v3>;
	vcc-pb-supply = <&reg_vcc_3v3>;
	vcc-pc-supply = <&reg_vcc_3v3>;
	vcc-pd-supply = <&reg_vcc_3v3>;
	vcc-pe-supply = <&reg_vcc_3v3>;
	vcc-pf-supply = <&reg_vcc_3v3>;
	vcc-pg-supply = <&reg_vcc_3v3>;

	
	uart2_pe2_pins: uart2-pe2-pins {
				pins = "PE2", "PE3";
				function = "uart2";
			};

	i2s2_pb_pins: i2s2-pb-pins {
		pins = "PB5", "PB6", "PB7";
		function = "i2s2";
	};

	i2s2_pb4_dout_pin: i2s2-pb4-dout-pin {
		pins = "PB4";
		function = "i2s2_dout";
	};

	i2c0_pb2_pins: i2c0-pb2-pins {
				pins = "PB2", "PB3";
				function = "i2c0";
			};

	pwm0_pd16_pin: pwm0-pd16-pin {
		pins = "PD16";
		function = "pwm";
	};

	pwm2_pd18_pin: pwm2-pd18-pin {
		pins = "PD18";
		function = "pwm";
	};

	pwm7_pd22_pin: pwm7-pd22-pin {
		pins = "PD22";
		function = "pwm";
	};
};

&i2c0 {
	pinctrl-0 = <&i2c0_pb2_pins>;
	pinctrl-names = "default";
	status = "okay";
};

&i2s2 {
	pinctrl-0 = <&i2s2_pb_pins>, <&i2s2_pb4_dout_pin>;
	pinctrl-names = "default";
	status = "okay";
};


};

};

&ohci0 {
	status = "okay";
};

&ohci1 {
	status = "okay";
};

&pwm {
	pinctrl-0 = <&pwm0_pd16_pin>, <&pwm2_pd18_pin>;
	pinctrl-names = "default";
	status = "okay";
};

&reg_aldo {
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	vdd33-supply = <&reg_vcc_3v3>;
};

&reg_hpldo {
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	hpldoin-supply = <&reg_vcc_3v3>;
};

&reg_ldoa {
	regulator-always-on;
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	ldo-in-supply = <&reg_vcc_3v3>;
};

&spi0 {
	pinctrl-0 = <&spi0_pins>;
	pinctrl-names = "default";
	status = "okay";

	spi-nor@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "winbond,w25q128", "jedec,spi-nor";
		reg = <0>;
		spi-max-frequency = <50000000>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 {
				label = "boot0";
				reg = <0x00000000 0x00100000>;
			};

			partition@100000 {
				label = "uboot";
				reg = <0x00100000 0x00300000>;
			};

			partition@400000 {
				label = "secure_storage";
				reg = <0x00400000 0x00100000>;
			};

			partition@500000 {
				label = "sys";
				reg = <0x00500000 0x0fb00000>;
			};
		};
	};
};


&i2c0 {
	pinctrl-0 = <&spi1_pd_pins>;
	pinctrl-names = "default";
	status = "okay";
};

&mmc0 {
	bus-width = <4>;
	cd-gpios = <&gpio 5 6 GPIO_ACTIVE_HIGH>; /* PF6 */
	disable-wp;
	vmmc-supply = <&reg_vcc_3v3>;
	vqmmc-supply = <&reg_vcc_3v3>;
	pinctrl-0 = <&mmc0_pins>;
	pinctrl-names = "default";
	status = "okay";
};


&ths {
	vref-supply = <&reg_aldo>;
};

&uart2 {
	pinctrl-0 = <&uart2-pe2-pins>;
	pinctrl-names = "default";
	status = "okay";
};

&usbphy {
	usb0_id_det-gpios = <&gpio 3 21 GPIO_ACTIVE_LOW>; /* PD21 */
	usb0_vbus_det-gpios = <&gpio 3 20 GPIO_ACTIVE_HIGH>; /* PD20 */
	usb0_vbus-supply = <&reg_usbvbus>;
	usb1_vbus-supply = <&reg_vcc>;
	status = "okay";
};
